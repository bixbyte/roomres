(function(c){var a=parseInt(Math.random()*1000),b=function(){var U={},d,P=65,u,R='<div class="colorpicker"><div id="colorpicker_window_controls"><a></a></div><div id="colorpicker_dialog_title">'+_("Choose a Color")+'</div><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><span>R:</span><input type="text" maxlength="3" size="3" /></div><div class="colorpicker_rgb_g colorpicker_field"><span>G:</span><input type="text" maxlength="3" size="3" /></div><div class="colorpicker_rgb_b colorpicker_field"><span>B:</span><input type="text" maxlength="3" size="3" /></div><div class="colorpicker_hsb_h colorpicker_field"><span>H:</span><input type="text" maxlength="3" size="3" /></div><div class="colorpicker_hsb_s colorpicker_field"><span>S:</span><input type="text" maxlength="3" size="3" /></div><div class="colorpicker_hsb_b colorpicker_field"><span>B:</span><input type="text" maxlength="3" size="3" /></div><button class="colorpicker_submit">'+_("Apply")+"</button></div>",C={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false,additionalDocuments:c(),iframeFix:false},J=function(){var W=1,V="colorpicker_"+a+"_"+W;do{V=V.replace(/\d+$/,W++)}while(c("#"+V).length>0);return V},L=function(V,X){var W=k(V);c(X).data("colorpicker").fields.eq(1).val(W.r).end().eq(2).val(W.g).end().eq(3).val(W.b).end()},v=function(V,W){c(W).data("colorpicker").fields.eq(4).val(V.h).end().eq(5).val(V.s).end().eq(6).val(V.b).end()},h=function(V,W){c(W).data("colorpicker").fields.eq(0).val(T(V)).end()},m=function(V,W){c(W).data("colorpicker").selector.css("backgroundColor","#"+T({h:V.h,s:100,b:100}));c(W).data("colorpicker").selectorIndic.css({left:parseInt(150*V.s/100,10),top:parseInt(150*(100-V.b)/100,10)})},H=function(V,W){c(W).data("colorpicker").hue.css("top",parseInt(150-150*V.h/360,10))},i=function(V,W){c(W).data("colorpicker").currentColor.css("backgroundColor","#"+T(V))},F=function(V,W){c(W).data("colorpicker").newColor.css("backgroundColor","#"+T(V))},o=function(V){var X=V.charCode||V.keyCode||-1;if((X>P&&X<=90)||X==32){return false}var W=c(this).parent().parent();if(W.data("colorpicker").livePreview===true){f.apply(this)}},f=function(W){var X=c(this).parent().parent(),V;if(this.parentNode.className.indexOf("_hex")>0){X.data("colorpicker").color=V=n(z(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){X.data("colorpicker").color=V=g({h:parseInt(X.data("colorpicker").fields.eq(4).val(),10),s:parseInt(X.data("colorpicker").fields.eq(5).val(),10),b:parseInt(X.data("colorpicker").fields.eq(6).val(),10)})}else{X.data("colorpicker").color=V=j(N({r:parseInt(X.data("colorpicker").fields.eq(1).val(),10),g:parseInt(X.data("colorpicker").fields.eq(2).val(),10),b:parseInt(X.data("colorpicker").fields.eq(3).val(),10)}))}}if(W){L(V,X.get(0));h(V,X.get(0));v(V,X.get(0))}m(V,X.get(0));H(V,X.get(0));F(V,X.get(0));X.data("colorpicker").onChange.apply(X,[V,T(V),k(V)])},p=function(V){var W=c(this).parent().parent();if(W.data("colorpicker")!=null&&W.data("colorpicker")!=undefined){W.data("colorpicker").fields.parent().removeClass("colorpicker_focus")}},M=function(){P=this.parentNode.className.indexOf("_hex")>0?70:65;if(c(this).parent().parent().data("colorpicker")!=null&&c(this).parent().parent().data("colorpicker")!=undefined){c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}c(this).parent().addClass("colorpicker_focus")},K=function(V){var X=c(this).parent().find("input").focus();var W={el:c(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:V.pageY,field:X,val:parseInt(X.val(),10),preview:c(this).parent().parent().data("colorpicker").livePreview};c(this).parent().parent().data("colorpicker").additionalDocuments.bind("mouseup",W,t);c(this).parent().parent().data("colorpicker").additionalDocuments.bind("mousemove",W,O);c(document).bind("mouseup",W,t);c(document).bind("mousemove",W,O)},O=function(V){V.data.field.val(Math.max(0,Math.min(V.data.max,parseInt(V.data.val+V.pageY-V.data.y,10))));if(V.data.preview){f.apply(V.data.field.get(0),[true])}return false},t=function(V){f.apply(V.data.field.get(0),[true]);V.data.el.removeClass("colorpicker_slider").find("input").focus();V.data.additionalDocuments.unbind("mouseup",t);V.data.additionalDocuments.unbind("mousemove",O);c(document).unbind("mouseup",t);c(document).unbind("mousemove",O);return false},x=function(V){var W={cal:c(this).parent(),y:c(this).offset().top};W.preview=W.cal.data("colorpicker").livePreview;W.cal.data("colorpicker").additionalDocuments.bind("mouseup",W,s);W.cal.data("colorpicker").additionalDocuments.bind("mousemove",W,l);c(document).bind("mouseup",W,s);c(document).bind("mousemove",W,l)},l=function(V){f.apply(V.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(V.pageY-V.data.y))))/150,10)).get(0),[V.data.preview]);return false},s=function(V){L(V.data.cal.data("colorpicker").color,V.data.cal.get(0));h(V.data.cal.data("colorpicker").color,V.data.cal.get(0));V.data.cal.data("colorpicker").additionalDocuments.unbind("mouseup",s);V.data.cal.data("colorpicker").additionalDocuments.unbind("mousemove",l);c(document).unbind("mouseup",s);c(document).unbind("mousemove",l);return false},y=function(V){var W={cal:c(this).parent(),pos:c(this).offset()};W.preview=W.cal.data("colorpicker").livePreview;W.cal.data("colorpicker").additionalDocuments.bind("mouseup",W,B);W.cal.data("colorpicker").additionalDocuments.bind("mousemove",W,r);c(document).bind("mouseup",W,B);c(document).bind("mousemove",W,r)},r=function(V){f.apply(V.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(V.pageY-V.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(V.pageX-V.data.pos.left))))/150,10)).get(0),[V.data.preview]);return false},B=function(V){f.apply(V.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(V.pageY-V.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(V.pageX-V.data.pos.left))))/150,10)).get(0),[V.data.preview]);L(V.data.cal.data("colorpicker").color,V.data.cal.get(0));h(V.data.cal.data("colorpicker").color,V.data.cal.get(0));V.data.cal.data("colorpicker").additionalDocuments.unbind("mouseup",B);V.data.cal.data("colorpicker").additionalDocuments.unbind("mousemove",r);c(document).unbind("mouseup",B);c(document).unbind("mousemove",r);return false},w=function(V){c(this).addClass("colorpicker_focus")},S=function(V){c(this).removeClass("colorpicker_focus")},q=function(W){var X=c(this).parent();var V=X.data("colorpicker").color;X.data("colorpicker").origColor=V;i(V,X.get(0));X.data("colorpicker").onSubmit(V,T(V),k(V),X.data("colorpicker").el)},E=function(V){var Z=c("#"+c(this).data("colorpickerId"));Z.data("colorpicker").onBeforeShow.apply(this,[Z.get(0)]);var aa=c(this).offset();var Y=A();var X=aa.top+this.offsetHeight;var W=aa.left;if(X+176>Y.t+Y.h){X-=this.offsetHeight+176}if(W+356>Y.l+Y.w){W-=356}Z.css({left:W+"px",top:X+"px"});if(Z.data("colorpicker").onShow.apply(this,[Z.get(0)])!=false){c(window).trigger("resize");Z.show(0)}Z.data("colorpicker").additionalDocuments.bind("mousedown",{cal:Z},Q);c(document).bind("mousedown",{cal:Z},Q);Z.draggable({handle:"#colorpicker_dialog_title",containment:"window",iframeFix:Z.data("colorpicker").iframeFix});Z.children().css("cursor","default");return false},Q=function(V){if(!I(V.data.cal.get(0),V.target,V.data.cal.get(0))){if(V.data.cal.data("colorpicker").onHide.apply(this,[V.data.cal.get(0)])!=false){V.data.cal.hide()}V.data.cal.data("colorpicker").additionalDocuments.unbind("mousedown",Q);c(document).unbind("mousedown",Q)}c(window).trigger("resize")},I=function(Y,X,V){if(Y==X){return true}if(Y.contains){if(X.tagName=="A"){return false}else{var W=Y.contains(X);return W}}if(Y.compareDocumentPosition){return !!(Y.compareDocumentPosition(X)&16)}var Z=X.parentNode;while(Z&&Z!=V){if(Z==Y){return true}Z=Z.parentNode}return false},A=function(){var V=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(V?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(V?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(V?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(V?document.documentElement.clientHeight:document.body.clientHeight)}},g=function(V){return{h:Math.min(360,Math.max(0,V.h)),s:Math.min(100,Math.max(0,V.s)),b:Math.min(100,Math.max(0,V.b))}},N=function(V){return{r:Math.min(255,Math.max(0,V.r)),g:Math.min(255,Math.max(0,V.g)),b:Math.min(255,Math.max(0,V.b))}},z=function(X){var V=6-X.length;if(V>0){var Y=[];for(var W=0;W<V;W++){Y.push("0")}Y.push(X);X=Y.join("")}return X},e=function(V){var V=parseInt(((V.indexOf("#")>-1)?V.substring(1):V),16);return{r:V>>16,g:(V&65280)>>8,b:(V&255)}},n=function(V){return j(e(V))},j=function(X){var W={h:0,s:0,b:0};var Y=Math.min(X.r,X.g,X.b);var V=Math.max(X.r,X.g,X.b);var Z=V-Y;W.b=V;if(V!=0){}W.s=V!=0?255*Z/V:0;if(W.s!=0){if(X.r==V){W.h=(X.g-X.b)/Z}else{if(X.g==V){W.h=2+(X.b-X.r)/Z}else{W.h=4+(X.r-X.g)/Z}}}else{W.h=-1}W.h*=60;if(W.h<0){W.h+=360}W.s*=100/255;W.b*=100/255;return W},k=function(V){var X={};var ab=Math.round(V.h);var aa=Math.round(V.s*255/100);var W=Math.round(V.b*255/100);if(aa==0){X.r=X.g=X.b=W}else{var ac=W;var Z=(255-aa)*W/255;var Y=(ac-Z)*(ab%60)/60;if(ab==360){ab=0}if(ab<60){X.r=ac;X.b=Z;X.g=Z+Y}else{if(ab<120){X.g=ac;X.b=Z;X.r=ac-Y}else{if(ab<180){X.g=ac;X.r=Z;X.b=Z+Y}else{if(ab<240){X.b=ac;X.r=Z;X.g=ac-Y}else{if(ab<300){X.b=ac;X.g=Z;X.r=Z+Y}else{if(ab<360){X.r=ac;X.g=Z;X.b=ac-Y}else{X.r=0;X.g=0;X.b=0}}}}}}}return{r:Math.round(X.r),g:Math.round(X.g),b:Math.round(X.b)}},D=function(V){var W=[V.r.toString(16),V.g.toString(16),V.b.toString(16)];c.each(W,function(X,Y){if(Y.length==1){W[X]="0"+Y}});return W.join("")},T=function(V){return D(k(V))},G=function(){var W=c(this).parent();var V=W.data("colorpicker").origColor;W.data("colorpicker").color=V;L(V,W.get(0));h(V,W.get(0));v(V,W.get(0));m(V,W.get(0));H(V,W.get(0));F(V,W.get(0));W.data("colorpicker").onChange.apply(W,[V,T(V),k(V)])};return{init:function(V){V=c.extend({},C,V||{});if(typeof V.color=="string"){V.color=n(V.color)}else{if(V.color.r!=undefined&&V.color.g!=undefined&&V.color.b!=undefined){V.color=j(V.color)}else{if(V.color.h!=undefined&&V.color.s!=undefined&&V.color.b!=undefined){V.color=g(V.color)}else{return this}}}return this.each(function(){if(!c(this).data("colorpickerId")){var W=c.extend({},V);W.origColor=V.color;var Y=J();c(this).data("colorpickerId",Y);var X=c(R).attr("id",Y);if(W.flat){X.appendTo(this).show(0)}else{X.appendTo(document.body)}W.fields=X.find("input").bind("keyup",o).bind("change",f).bind("blur",p).bind("focus",M);X.find("span").bind("mousedown",K).end().find(">div.colorpicker_current_color").bind("click",G);W.selector=X.find("div.colorpicker_color").bind("mousedown",y);W.selectorIndic=W.selector.find("div div");W.el=this;W.hue=X.find("div.colorpicker_hue div");X.find("div.colorpicker_hue").bind("mousedown",x);W.newColor=X.find("div.colorpicker_new_color");W.currentColor=X.find("div.colorpicker_current_color");X.data("colorpicker",W);X.find("button.colorpicker_submit").bind("mouseenter",w).bind("mouseleave",S).bind("click",q);X.find("#colorpicker_window_controls a").click(function(Z){Z.preventDefault();c(this).parents(".colorpicker").hide();return false});L(W.color,X.get(0));v(W.color,X.get(0));h(W.color,X.get(0));H(W.color,X.get(0));m(W.color,X.get(0));i(W.color,X.get(0));F(W.color,X.get(0));if(W.flat){X.css({position:"relative",display:"block"})}else{c(this).bind(W.eventName,E)}}})},showPicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){E(0).apply(this)}})},hidePicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){c("#"+c(this).data("colorpickerId")).hide(0)}})},setColor:function(V){if(typeof V=="string"){V=n(V)}else{if(V.r!=undefined&&V.g!=undefined&&V.b!=undefined){V=j(V)}else{if(V.h!=undefined&&V.s!=undefined&&V.b!=undefined){V=g(V)}else{return this}}}return this.each(function(){if(c(this).data("colorpickerId")){var W=c("#"+c(this).data("colorpickerId"));W.data("colorpicker").color=V;W.data("colorpicker").origColor=V;L(V,W.get(0));v(V,W.get(0));h(V,W.get(0));H(V,W.get(0));m(V,W.get(0));i(V,W.get(0));F(V,W.get(0))}})}}}();c.fn.extend({ColorPicker:b.init,ColorPickerHide:b.hidePicker,ColorPickerShow:b.showPicker,ColorPickerSetColor:b.setColor})})(jQuery);